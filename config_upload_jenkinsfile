pipeline {
    agent any

    environment {
        EMS_URL = "https://172.27.28.193.nip.io/ems/login"
        EMS_USER = "root"
        EMS_PASS = "root123"
        CONFIG_ZIP = "/var/lib/jenkins/downloads/merged_config.zip"
        VENV_PATH = "venv"
    }

    stages {
        stage('Unzip Config Files') {
            steps {
                sh 'rm -rf config_files && mkdir config_files'
                sh "unzip -o ${CONFIG_ZIP} -d config_files"
            }
        }

        stage('Setup Python Environment') {
            steps {
                sh 'python3 -m venv venv'
                sh './venv/bin/pip install --upgrade pip'
                sh './venv/bin/pip install selenium'
            }
        }

        stage('Run GUI Automation') {
            steps {
                sh './venv/bin/python3 scripts/gui_upload.py'
            }
        }
    }
}
